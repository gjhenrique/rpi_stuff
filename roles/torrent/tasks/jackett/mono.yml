- name: Install mono
  apt:
    update_cache: true
    name: mono-complete

- name: Register current installed jacket version
  command: "mono --debug /usr/lib/jackett/JackettConsole.exe --version"
  register: jackett_version
  changed_when: false
  ignore_errors: true

- debug:
    var: jackett_version

- name: New Jackett
  set_fact:
    install_jackett: true
  when: (jackett_version.rc != 1 or (not jackett_version.stdout | regex_search(torrent_jackett_version)))

- name: Download jackett bin
  get_url:
    url: "https://github.com/Jackett/Jackett/releases/download/{{ torrent_jackett_version }}/Jackett.Binaries.Mono.tar.gz"
    dest: /tmp/jackett-mono-{{ torrent_jackett_version }}.tar.gz
  when: install_jackett is defined

- name: Extract jackett bin  # noqa 303
  shell: |
    tar -xzvf jackett-mono-{{ torrent_jackett_version }}.tar.gz
    rm -rf /usr/lib/jackett
    mv Jackett /usr/lib/jackett
  args:
    chdir: "/tmp"
  when: install_jackett is defined

- name: Deploy jackett service file
  copy:
    src: jackett-mono.service
    dest: /lib/systemd/system/jackett.service
    mode: '0644'
  notify:
    - reload jackett
