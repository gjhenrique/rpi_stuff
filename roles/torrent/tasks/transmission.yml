---
- name: Install transmission
  apt:
    update_cache: true
    name: transmission-daemon

- name: Copy transmission custom systemd service
  template:
    src: transmission-daemon-custom.service.j2
    dest: /lib/systemd/system/transmission-daemon-custom.service
    mode: '0644'
  notify: reload transmission

- name: Stop vanilla transmission service
  systemd:
    name: transmission-daemon-custom
    state: stopped
  notify: reload transmission

- name: Copy transmission nginx config file
  template:
    src: transmission.conf.j2
    dest: /etc/nginx/sites-available/torrent.conf
    mode: '0644'
  notify: restart nginx

- name: Symlink sites-available to sites-enabled
  file:
    src: '/etc/nginx/sites-available/torrent.conf'
    dest: '/etc/nginx/sites-enabled/torrent.conf'
    state: 'link'
  notify: restart nginx

- name: Enable/Start transmission service
  systemd:
    name: transmission-daemon-custom
    enabled: true
    state: started
